<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام إدارة الموظفين - مستشفى ابن سينا التعليمي</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS RTL -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">

    <style>
        :root {
            --bg-color: #f5f6fa;
            --bg-soft: #ffffff;
            --text-color: #1f2933;
            --muted-text: #6b7280;
            --accent: #0d6efd;
            --accent-soft: rgba(13, 110, 253, 0.08);
            --border-color: #e5e7eb;
            --sidebar-bg: #0d6efd;
            --sidebar-text: #ffffff;
            --shadow-soft: 0 12px 30px rgba(15, 23, 42, 0.08);
            --table-header-bg: #e9ecef;
        }
        .theme-light {
            --bg-color: #f5f6fa;
            --bg-soft: #ffffff;
            --text-color: #111827;
            --muted-text: #6b7280;
            --accent: #0d6efd;
            --accent-soft: rgba(13, 110, 253, 0.08);
            --border-color: #e5e7eb;
            --sidebar-bg: #0d6efd;
            --sidebar-text: #ffffff;
            --table-header-bg: #eef2ff;
        }
        .theme-dark {
            --bg-color: #030712;
            --bg-soft: #020617;
            --text-color: #e5e7eb;
            --muted-text: #9ca3af;
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.1);
            --border-color: #1f2937;
            --sidebar-bg: #020617;
            --sidebar-text: #e5e7eb;
            --table-header-bg: #111827;
        }
        .theme-ocean {
            --bg-color: #0f172a;
            --bg-soft: #0b1220;
            --text-color: #e5e7eb;
            --muted-text: #9ca3af;
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.14);
            --border-color: #1e293b;
            --sidebar-bg: #020617;
            --sidebar-text: #e5e7eb;
            --table-header-bg: #0b1120;
        }
        .theme-sepia {
            --bg-color: #f4eee2;
            --bg-soft: #fdf7ec;
            --text-color: #3b2f2f;
            --muted-text: #7c6a5f;
            --accent: #c47f3a;
            --accent-soft: rgba(196, 127, 58, 0.1);
            --border-color: #e0d0b8;
            --sidebar-bg: #c47f3a;
            --sidebar-text: #fff7ec;
            --table-header-bg: #f3e3cf;
        }
        .theme-comfort {
            --bg-color: #edf2f7;
            --bg-soft: #ffffff;
            --text-color: #1a202c;
            --muted-text: #718096;
            --accent: #4299e1;
            --accent-soft: rgba(66, 153, 225, 0.12);
            --border-color: #e2e8f0;
            --sidebar-bg: #2d3748;
            --sidebar-text: #e2e8f0;
            --table-header-bg: #e2e8f0;
        }

        /* ثيمات خاصة بالمستشفى */
        .theme-hospital-blue {
            --bg-color: #e9f4ff;
            --bg-soft: #ffffff;
            --text-color: #102a43;
            --muted-text: #627d98;
            --accent: #0ea5e9;
            --accent-soft: rgba(14, 165, 233, 0.14);
            --border-color: #cbd2e1;
            --sidebar-bg: #0f172a;
            --sidebar-text: #e5e7eb;
            --table-header-bg: #dbeafe;
        }
        .theme-hospital-soft {
            --bg-color: #f6fbff;
            --bg-soft: #ffffff;
            --text-color: #1f2933;
            --muted-text: #6b7280;
            --accent: #10b981;
            --accent-soft: rgba(16, 185, 129, 0.12);
            --border-color: #d1e3f0;
            --sidebar-bg: #0284c7;
            --sidebar-text: #f9fafb;
            --table-header-bg: #e0f2fe;
        }
        .theme-hospital-dark {
            --bg-color: #020617;
            --bg-soft: #020617;
            --text-color: #e5e7eb;
            --muted-text: #9ca3af;
            --accent: #22c55e;
            --accent-soft: rgba(34, 197, 94, 0.18);
            --border-color: #1f2937;
            --sidebar-bg: #020617;
            --sidebar-text: #e5e7eb;
            --table-header-bg: #020617;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }
        .sidebar {
            min-height: 100vh;
            background: var(--sidebar-bg);
            color: var(--sidebar-text);
        }
        .sidebar a {
            color: var(--sidebar-text);
            text-decoration: none;
            border-radius: .6rem;
            padding: .55rem .9rem;
            display: block;
        }
        .sidebar a:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }
        .sidebar a.active {
            background: rgba(255, 255, 255, 0.16);
        }
        main { background-color: var(--bg-color); }
        .card {
            border: 1px solid var(--border-color);
            background-color: var(--bg-soft);
            box-shadow: var(--shadow-soft);
            border-radius: 1rem;
        }
        .page-title { font-weight: 700; }
        .text-muted { color: var(--muted-text) !important; }
        .btn-primary,
        .btn-outline-primary:hover {
            background-color: var(--accent);
            border-color: var(--accent);
        }
        .btn-outline-primary {
            color: var(--accent);
            border-color: var(--accent);
        }
        .filter-chip {
            background-color: var(--accent-soft);
            border-radius: 999px;
            padding: .25rem .75rem;
            font-size: .8rem;
        }
        .theme-selector { min-width: 210px; }
        section { margin-bottom: 2.5rem; }
        .section-title { margin-bottom: .5rem; }

        /* جدول الموظفين (تصميم + فرز يدوي) */
        .employee-table-wrapper {
            max-height: 500px;
            overflow-y: auto;
            border-radius: .9rem;
            border: 1px solid var(--border-color);
        }
        .employee-table {
            min-width: 1350px;
            border-collapse: separate;
            border-spacing: 0;
            font-size: .85rem;
        }
        .employee-table thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background-color: var(--table-header-bg);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(15, 23, 42, 0.06);
            text-align: center;
            white-space: nowrap;
            user-select: none;
        }
        .employee-table thead th.sortable {
            cursor: pointer;
        }
        .employee-table thead th.sortable::after {
            content: "⇅";
            font-size: .7rem;
            margin-right: .35rem;
            opacity: .35;
        }
        .employee-table thead th.sort-asc::after {
            content: "▲";
            opacity: .8;
        }
        .employee-table thead th.sort-desc::after {
            content: "▼";
            opacity: .8;
        }
        .employee-table tbody td {
            vertical-align: middle;
            white-space: nowrap;
        }
        .employee-table tbody tr:nth-child(even) {
            background-color: rgba(148, 163, 184, 0.06);
        }
        .employee-table tbody tr:hover {
            background-color: rgba(59, 130, 246, 0.10);
        }
        .badge-status {
            font-size: 0.7rem;
            padding: .25rem .5rem;
            border-radius: 999px;
        }

        /* صفحة/طبقة نموذج الموظف */
        .employee-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.45);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 1rem;
            z-index: 1050;
        }
        .employee-overlay .card {
            width: 100%;
            max-width: 1200px;
            max-height: 100%;
            overflow-y: auto;
        }
    </style>
</head>
<body class="theme-hospital-soft">
<div class="container-fluid">
    <div class="row">
        <!-- الشريط الجانبي -->
        <nav class="col-md-2 col-lg-2 d-md-block sidebar p-3">
            <div class="d-flex align-items-center justify-content-between mb-4">
                <h5 class="mb-0">نظام الموظفين</h5>
                <span class="badge bg-light text-dark">HR</span>
            </div>
            <ul class="nav flex-column gap-1">
                <li class="nav-item">
                    <a class="nav-link" href="#dashboard">لوحة التحكم</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="#employees">الموظفون</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#leaves">الإجازات</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#reports">التقارير</a>
                </li>
                <li class="nav-item mt-4">
                    <a class="nav-link" href="#logout">تسجيل الخروج</a>
                </li>
            </ul>
        </nav>

        <!-- المحتوى -->
        <main class="col-md-10 col-lg-10 ms-auto p-4">
            <!-- شريط علوي -->
            <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
                <div>
                    <h2 class="page-title mb-1">نظام إدارة موظفي مستشفى ابن سينا التعليمي</h2>
                    <p class="text-muted mb-0">لوحة تحكم، موظفون، إجازات، وتقارير في منصة واحدة.</p>
                </div>
                <div class="d-flex	align-items-center gap-2">
                    <span class="text-muted small">ثيم الواجهة:</span>
                    <select id="themeSelect" class="form-select form-select-sm theme-selector">
                        <option value="theme-hospital-soft">مستشفى – ناعم (افتراضي)</option>
                        <option value="theme-hospital-blue">مستشفى – أزرق</option>
                        <option value="theme-hospital-dark">مستشفى – داكن</option>
                        <option value="theme-comfort">مريح</option>
                        <option value="theme-light">فاتح</option>
                        <option value="theme-dark">داكن</option>
                        <option value="theme-ocean">أوشن</option>
                        <option value="theme-sepia">سيبيا</option>
                    </select>
                </div>
            </div>

            <!-- لوحة التحكم -->
            <section id="dashboard">
                <h4 class="section-title">لوحة التحكم</h4>
                <p class="text-muted">نظرة سريعة على أعداد الموظفين والإجازات.</p>

                <div class="row g-3 mb-3">
                    <div class="col-md-3">
                        <div class="card p-3">
                            <p class="text-muted mb-1">إجمالي الموظفين</p>
                            <h3 id="dashTotalEmployees" class="mb-0">0</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3">
                            <p class="text-muted mb-1">مستمرون بالخدمة</p>
                            <h3 id="dashActiveEmployees" class="mb-0">0</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3">
                            <p class="text-muted mb-1">الذكور</p>
                            <h3 id="dashMaleEmployees" class="mb-0">0</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3">
                            <p class="text-muted mb-1">الإناث</p>
                            <h3 id="dashFemaleEmployees" class="mb-0">0</h3>
                        </div>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="card p-3">
                            <p class="text-muted mb-1">إجمالي الإجازات</p>
                            <h4 id="dashTotalLeaves" class="mb-0">0</h4>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-3">
                            <p class="text-muted mb-1">إجازات مقبولة</p>
                            <h4 id="dashAcceptedLeaves" class="mb-0">0</h4>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-3">
                            <p class="text-muted mb-1">إجازات قيد الانتظار</p>
                            <h4 id="dashPendingLeaves" class="mb-0">0</h4>
                        </div>
                    </div>
                </div>
            </section>

            <!-- الموظفون -->
            <section id="employees">
                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                    <div>
                        <h4 class="section-title mb-1">قائمة الموظفين</h4>
                        <p class="text-muted mb-0">إدارة بيانات جميع الموظفين.</p>
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                        <!-- Excel -->
                        <button id="btnImportExcel" class="btn btn-outline-secondary btn-sm">
                            استيراد من Excel
                        </button>
                        <input type="file" id="importExcelFile" accept=".csv,.xlsx" class="d-none">
                        <button id="btnExportExcel" class="btn btn-outline-primary btn-sm">
                            تصدير إلى Excel
                        </button>
                        <!-- JSON -->
                        <button id="btnImportJson" class="btn btn-outline-secondary btn-sm">
                            استيراد JSON
                        </button>
                        <input type="file" id="importJsonFile" accept=".json" class="d-none">
                        <button id="btnExportJson" class="btn btn-outline-primary btn-sm">
                            تصدير JSON
                        </button>
                        <!-- حفظ و إضافة -->
                        <button id="btnSave" class="btn btn-success btn-sm">
                            حفظ البيانات
                        </button>
                        <button id="btnAdd" class="btn btn-primary btn-sm">
                            + إضافة موظف جديد
                        </button>
                    </div>
                </div>

                <div class="d-flex justify-content-start align-items-center mb-3 flex-wrap gap-2">
                    <span class="filter-chip">
                        المجموع: <span id="totalCount">0</span> موظف
                    </span>
                    <span class="filter-chip">
                        مستمر بالخدمة: <span id="activeCount">0</span>
                    </span>
                    <span class="filter-chip">
                        الذكور: <span id="maleCount">0</span>
                    </span>
                    <span class="filter-chip">
                        الإناث: <span id="femaleCount">0</span>
                    </span>
                </div>

                <!-- إحصائيات نصية (مخفية) -->
                <div class="mb-3 d-none">
                    <small class="text-muted d-block">
                        حالات الخدمة: <span id="statusStats">لا توجد بيانات بعد</span>
                    </small>
                    <small class="text-muted d-block">
                        توزيع حسب الدائرة: <span id="deptStats">لا توجد بيانات بعد</span>
                    </small>
                </div>

                <div class="card">
                    <div class="card-body">
                        <form id="filterForm" class="row g-2 mb-3">
                            <div class="col-md-3">
                                <label class="form-label">الاسم</label>
                                <input type="text" id="filterName" class="form-control" placeholder="بحث بالاسم">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">الدائرة</label>
                                <select id="filterDept" class="form-select">
                                    <option value="">الكل</option>
                                    <option value="مكتب الوزير / الملاك">مكتب الوزير / الملاك</option>
                                    <option value="دائرة الموارد البشرية">دائرة الموارد البشرية</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">الحالة الوظيفية</label>
                                <select id="filterStatus" class="form-select">
                                    <option value="">الكل</option>
                                    <option value="مستمر بالخدمة">مستمر بالخدمة</option>
                                    <option value="إجازة">إجازة</option>
                                    <option value="متقاعد">متقاعد</option>
                                    <option value="متدرب">متدرب</option>
                                </select>
                            </div>
                            <div class="col-md-3 d-flex align-items-end gap-2">
                                <button type="submit" class="btn btn-secondary w-100">بحث</button>
                                <button type="button" id="btnReset" class="btn btn-outline-secondary">مسح</button>
                            </div>
                        </form>

                        <!-- جدول الموظفين -->
                        <div class="employee-table-wrapper">
                            <table class="employee-table table table-sm table-hover align-middle mb-0">
                                <thead>
                                <tr>
                                    <!-- أقصى اليسار: إجراءات -->
                                    <th class="text-center">إجراءات</th>

                                    <th data-sort-key="hireDate" class="sortable">تاريخ التعيين</th>
                                    <th data-sort-key="birthDate" class="sortable">تاريخ التولد</th>
                                    <th data-sort-key="gender" class="sortable">الجنس</th>
                                    <th data-sort-key="motherName" class="sortable">أسم الأم الثلاثي</th>
                                    <th data-sort-key="nationalId" class="sortable">الرقم الوطني</th>
                                    <th data-sort-key="jobNumber" class="sortable">الرقم الوظيفي</th>
                                    <th data-sort-key="department" class="sortable">أسم الدائرة / مبنى الوزارة</th>
                                    <th data-sort-key="notes" class="sortable">الملاحظات</th>
                                    <th data-sort-key="status" class="sortable">الحالة الوظيفية</th>
                                </tr>
                                </thead>
                                <tbody id="employeesTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- طبقة نموذج إضافة/تعديل موظف -->
            <div id="employeeFormSection" class="employee-overlay d-none">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 id="employeeFormTitle" class="mb-0">إضافة موظف جديد</h5>
                            <button type="button" id="employeeFormClose" class="btn btn-sm btn-outline-secondary">
                                إغلاق النموذج
                            </button>
                        </div>

                        <form id="employeeForm" class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">الأسم الاول</label>
                                <input type="text" id="empFirstName" class="form-control" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">الأسم الثاني</label>
                                <input type="text" id="empSecondName" class="form-control">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">الأسم الثالث</label>
                                <input type="text" id="empThirdName" class="form-control">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">الأسم الرابع</label>
                                <input type="text" id="empFourthName" class="form-control">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">العنوان الوظيفي</label>
                                <input type="text" id="empJobTitle" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">الحالة الوظيفية</label>
                                <select id="empStatus" class="form-select" required>
                                    <option value="مستمر بالخدمة">مستمر بالخدمة</option>
                                    <option value="إجازة">إجازة</option>
                                    <option value="متقاعد">متقاعد</option>
                                    <option value="متدرب">متدرب</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">أسم الدائرة / مبنى الوزارة</label>
                                <input type="text" id="empDept" class="form-control" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">الرقم الوظيفي</label>
                                <input type="text" id="empJobNumber" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">الرقم الوطني</label>
                                <input type="text" id="empNationalId" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">أسم الأم الثلاثي</label>
                                <input type="text" id="empMotherName" class="form-control">
                            </div>

                            <div class="col-md-3">
                                <label class="form-label">الجنس</label>
                                <select id="empGender" class="form-select">
                                    <option value="">غير محدد</option>
                                    <option value="ذكر">ذكر</option>
                                    <option value="أنثى">أنثى</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">تاريخ التولد</label>
                                <input type="date" id="empBirthDate" class="form-control">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">تاريخ التعيين</label>
                                <input type="date" id="empHireDate" class="form-control">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">الملاحظات</label>
                                <input type="text" id="empNotes" class="form-control">
                            </div>

                            <div class="col-12 d-flex justify-content-end gap-2 mt-2">
                                <button type="button" id="employeeFormCancel" class="btn btn-outline-secondary">
                                    إلغاء
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    حفظ البيانات
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- الإجازات -->
            <section id="leaves">
                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                    <div>
                        <h4 class="section-title mb-1">الإجازات</h4>
                        <p class="text-muted mb-0">متابعة طلبات الإجازة وحالتها.</p>
                    </div>
                    <button id="btnAddLeave" class="btn btn-primary btn-sm">
                        + طلب إجازة جديد
                    </button>
                </div>

                <div class="d-flex justify-content-start align-items-center mb-3 flex-wrap gap-2">
                    <span class="filter-chip">
                        إجمالي الإجازات: <span id="totalLeaves">0</span>
                    </span>
                    <span class="filter-chip">
                        قيد الانتظار: <span id="pendingLeaves">0</span>
                    </span>
                    <span class="filter-chip">
                        مقبولة: <span id="acceptedLeaves">0</span>
                    </span>
                    <span class="filter-chip">
                        مرفوضة: <span id="rejectedLeaves">0</span>
                    </span>
                </div>

                <div class="card mb-3">
                    <div class="card-body">
                        <form id="filterLeaveForm" class="row g-2">
                            <div class="col-md-4">
                                <label class="form-label">اسم الموظف</label>
                                <input type="text" id="filterLeaveName" class="form-control" placeholder="بحث بالاسم">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">نوع الإجازة</label>
                                <select id="filterLeaveType" class="form-select">
                                    <option value="">الكل</option>
                                    <option value="اعتيادية">اعتيادية</option>
                                    <option value="مرضية">مرضية</option>
                                    <option value="طارئة">طارئة</option>
                                    <option value="دراسية">دراسية</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">حالة الطلب</label>
                                <select id="filterLeaveStatus" class="form-select">
                                    <option value="">الكل</option>
                                    <option value="مقدمة">مقدمة</option>
                                    <option value="مقبولة">مقبولة</option>
                                    <option value="مرفوضة">مرفوضة</option>
                                    <option value="منتهية">منتهية</option>
                                </select>
                            </div>
                            <div class="col-12 d-flex justify-content-end	align-items-end pt-2 gap-2">
                                <button type="submit" class="btn btn-secondary">بحث</button>
                                <button type="button" id="btnResetLeaves" class="btn btn-outline-secondary">مسح</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>الموظف</th>
                                <th>نوع الإجازة</th>
                                <th>من تاريخ</th>
                                <th>إلى تاريخ</th>
                                <th>الحالة</th>
                                <th>المعتمد</th>
                                <th class="text-center">إجراءات</th>
                            </tr>
                            </thead>
                            <tbody id="leavesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- التقارير -->
            <section id="reports">
                <h4 class="section-title">التقارير والإحصائيات</h4>
                <p class="text-muted">توزيع الموظفين حسب الدائرة والحالة والجنس، مع ملخص عام.</p>

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card p-3">
                            <h6 class="mb-3">توزيع الموظفين حسب الدائرة</h6>
                            <table class="table table-sm mb-0">
                                <thead>
                                <tr>
                                    <th>الدائرة</th>
                                    <th>عدد الموظفين</th>
                                </tr>
                                </thead>
                                <tbody id="deptReportBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card p-3">
                            <h6 class="mb-3">توزيع الموظفين حسب الحالة الوظيفية</h6>
                            <table class="table table-sm mb-0">
                                <thead>
                                <tr>
                                    <th>الحالة الوظيفية</th>
                                    <th>العدد</th>
                                </tr>
                                </thead>
                                <tbody id="statusReportBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mt-1">
                    <div class="col-md-6">
                        <div class="card p-3">
                            <h6 class="mb-3">توزيع الموظفين حسب الجنس</h6>
                            <table class="table table-sm mb-0">
                                <thead>
                                <tr>
                                    <th>الجنس</th>
                                    <th>العدد</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>ذكر</td>
                                    <td id="genderMaleReport">0</td>
                                </tr>
                                <tr>
                                    <td>أنثى</td>
                                    <td id="genderFemaleReport">0</td>
                                </tr>
                                <tr>
                                    <td>غير محدد</td>
                                    <td id="genderOtherReport">0</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card p-3">
                            <h6 class="mb-3">ملخص سريع</h6>
                            <ul class="mb-0 small">
                                <li>إجمالي الموظفين: <span id="reportTotalEmployees">0</span></li>
                                <li>الموظفون على رأس الخدمة: <span id="reportActiveEmployees">0</span></li>
                                <li>إجمالي الإجازات: <span id="reportTotalLeaves">0</span></li>
                                <li>إجازات مقبولة: <span id="reportAcceptedLeaves">0</span></li>
                                <li>إجازات قيد الانتظار: <span id="reportPendingLeaves">0</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
    const STORAGE_KEYS = {
        employees: "hr_employees_v1",
        leaves: "hr_leaves_v1",
        section: "hr_current_section_v1"
    };

    // بيانات أولية (تستخدم أول مرة فقط إذا لا يوجد تخزين سابق)
    const employees = [
        {
            id: 1,
            fullName: "توفيق سالم ابتهال",
            jobNumber: "196758925337",
            jobTitle: "رئيس أطباء اختصاص",
            department: "مكتب الوزير / الملاك",
            hireDate: "1991-11-01",
            status: "مستمر بالخدمة",
            gender: "ذكر",
            nationalId: "",
            motherName: "",
            birthDate: "1967-10-05",
            notes: ""
        },
        {
            id: 2,
            fullName: "احمد ابراهيم سلمان",
            jobNumber: "200065880073",
            jobTitle: "تقني أشعة وسونار",
            department: "مكتب الوزير / الملاك",
            hireDate: "2023-11-19",
            status: "مستمر بالخدمة",
            gender: "ذكر",
            nationalId: "",
            motherName: "",
            birthDate: "2000-02-15",
            notes: ""
        },
        {
            id: 3,
            fullName: "سعاد محمد مبارك",
            jobNumber: "113023332",
            jobTitle: "رئيس ممرضين",
            department: "دائرة الموارد البشرية",
            hireDate: "2005-07-31",
            status: "إجازة",
            gender: "أنثى",
            nationalId: "",
            motherName: "",
            birthDate: "1968-09-05",
            notes: ""
        },
        {
            id: 4,
            fullName: "حسن فليح إسماعيل",
            jobNumber: "115714223",
            jobTitle: "طبيب اختصاص أشعة",
            department: "مكتب الوزير / الملاك",
            hireDate: "2010-01-18",
            status: "مستمر بالخدمة",
            gender: "ذكر",
            nationalId: "",
            motherName: "",
            birthDate: "1998-08-22",
            notes: ""
        }
    ];

    const leaves = [
        { id: 1, employeeId: 3, employeeName: "سعاد محمد مبارك", type: "مرضية",   startDate: "2025-01-05", endDate: "2025-01-10", status: "مقبولة", approvedBy: "رئيس قسم التمريض" },
        { id: 2, employeeId: 4, employeeName: "حسن فليح إسماعيل", type: "اعتيادية", startDate: "2025-02-01", endDate: "2025-02-07", status: "مقدمة", approvedBy: "" },
        { id: 3, employeeId: 2, employeeName: "احمد ابراهيم سلمان",    type: "اعتيادية", startDate: "2024-12-01", endDate: "2024-12-10", status: "منتهية", approvedBy: "مدير المستشفى" }
    ];

    // تخزين محلي
    function saveDataToStorage() {
        try {
            localStorage.setItem(STORAGE_KEYS.employees, JSON.stringify(employees));
            localStorage.setItem(STORAGE_KEYS.leaves, JSON.stringify(leaves));
        } catch (e) {
            console.error("localStorage error:", e);
        }
    }

    function loadDataFromStorage() {
        try {
            const empStr = localStorage.getItem(STORAGE_KEYS.employees);
            if (empStr) {
                const arr = JSON.parse(empStr);
                if (Array.isArray(arr)) {
                    employees.length = 0;
                    arr.forEach(e => employees.push(e));
                }
            }
            const lvStr = localStorage.getItem(STORAGE_KEYS.leaves);
            if (lvStr) {
                const arr = JSON.parse(lvStr);
                if (Array.isArray(arr)) {
                    leaves.length = 0;
                    arr.forEach(l => leaves.push(l));
                }
            }
        } catch (e) {
            console.error("load storage error", e);
        }
    }

    loadDataFromStorage();

    let currentView = [...employees];
    let currentLeavesView = [...leaves];
    let editingEmployeeId = null;
    let currentSort = { key: null, dir: "asc" };

    // DOM
    const bodyEl = document.body;
    const themeSelect = document.getElementById("themeSelect");

    const tableBody = document.getElementById("employeesTableBody");
    const totalCountSpan = document.getElementById("totalCount");
    const activeCountSpan = document.getElementById("activeCount");
    const maleCountSpan = document.getElementById("maleCount");
    const femaleCountSpan = document.getElementById("femaleCount");
    const statusStatsSpan = document.getElementById("statusStats");
    const deptStatsSpan = document.getElementById("deptStats");

    const filterForm = document.getElementById("filterForm");
    const filterName = document.getElementById("filterName");
    const filterDept = document.getElementById("filterDept");
    const filterStatus = document.getElementById("filterStatus");
    const btnReset = document.getElementById("btnReset");

    const btnAdd = document.getElementById("btnAdd");
    const btnExportExcel = document.getElementById("btnExportExcel");
    const btnImportExcel = document.getElementById("btnImportExcel");
    const importExcelFileInput = document.getElementById("importExcelFile");

    const btnExportJson = document.getElementById("btnExportJson");
    const btnImportJson = document.getElementById("btnImportJson");
    const importJsonFileInput = document.getElementById("importJsonFile");

    const btnSave = document.getElementById("btnSave");

    const dashTotalEmployees = document.getElementById("dashTotalEmployees");
    const dashActiveEmployees = document.getElementById("dashActiveEmployees");
    const dashMaleEmployees = document.getElementById("dashMaleEmployees");
    const dashFemaleEmployees = document.getElementById("dashFemaleEmployees");
    const dashTotalLeaves = document.getElementById("dashTotalLeaves");
    const dashAcceptedLeaves = document.getElementById("dashAcceptedLeaves");
    const dashPendingLeaves = document.getElementById("
