<script>
    // ===========================
    // بيانات الموظفين (مثال) - عدلها حسب بياناتك الحقيقية
    // ===========================
    const employees = [
        {
            id: 1,
            fullName: "توفيق سالم ابتهال",
            jobNumber: "196758925337",
            jobTitle: "رئيس أطباء اختصاص",
            department: "مكتب الوزير / الملاك",
            hireDate: "1991-11-01",
            status: "مستمر بالخدمة",
            gender: "ذكر"
        },
        {
            id: 2,
            fullName: "احمد ابراهيم سلمان",
            jobNumber: "200065880073",
            jobTitle: "تقني أشعة وسونار",
            department: "مكتب الوزير / الملاك",
            hireDate: "2023-11-19",
            status: "مستمر بالخدمة",
            gender: "ذكر"
        },
        {
            id: 3,
            fullName: "سعاد محمد مبارك",
            jobNumber: "113023332",
            jobTitle: "رئيس ممرضين",
            department: "دائرة الموارد البشرية",
            hireDate: "2005-07-31",
            status: "إجازة",
            gender: "أنثى"
        },
        {
            id: 4,
            fullName: "حسن فليح إسماعيل",
            jobNumber: "115714223",
            jobTitle: "طبيب اختصاص أشعة",
            department: "مكتب الوزير / الملاك",
            hireDate: "2010-01-18",
            status: "مستمر بالخدمة",
            gender: "ذكر"
        },
        {
            id: 5,
            fullName: "هند كامل محمد",
            jobNumber: "113056239",
            jobTitle: "رئيس مصوري أشعة",
            department: "مكتب الوزير / الملاك",
            hireDate: "2014-03-20",
            status: "متقاعد",
            gender: "أنثى"
        },
        {
            id: 6,
            fullName: "مها معاذ عباس",
            jobNumber: "153434619",
            jobTitle: "تقنية تمريض",
            department: "دائرة الموارد البشرية",
            hireDate: "2023-09-24",
            status: "متدرب",
            gender: "أنثى"
        }
    ];

    // ===========================
    // بيانات الإجازات (مثال)
    // ===========================
    const leaves = [
        {
            id: 1,
            employeeId: 3,
            employeeName: "سعاد محمد مبارك",
            type: "مرضية",
            startDate: "2025-01-05",
            endDate: "2025-01-10",
            status: "مقبولة",
            approvedBy: "رئيس قسم التمريض"
        },
        {
            id: 2,
            employeeId: 4,
            employeeName: "حسن فليح إسماعيل",
            type: "اعتيادية",
            startDate: "2025-02-01",
            endDate: "2025-02-07",
            status: "مقدمة",
            approvedBy: ""
        },
        {
            id: 3,
            employeeId: 5,
            employeeName: "هند كامل محمد",
            type: "اعتيادية",
            startDate: "2024-12-01",
            endDate: "2024-12-10",
            status: "منتهية",
            approvedBy: "مدير المستشفى"
        },
        {
            id: 4,
            employeeId: 6,
            employeeName: "مها معاذ عباس",
            type: "طارئة",
            startDate: "2025-03-15",
            endDate: "2025-03-18",
            status: "مرفوضة",
            approvedBy: "رئيس الموارد البشرية"
        }
    ];

    let currentView = [...employees];
    let currentLeavesView = [...leaves];

    // عناصر الموظفين
    const tableBody = document.getElementById("employeesTableBody");
    const totalCountSpan = document.getElementById("totalCount");
    const activeCountSpan = document.getElementById("activeCount");
    const maleCountSpan = document.getElementById("maleCount");
    const femaleCountSpan = document.getElementById("femaleCount");
    const statusStatsSpan = document.getElementById("statusStats");
    const deptStatsSpan = document.getElementById("deptStats");

    const filterForm = document.getElementById("filterForm");
    const filterName = document.getElementById("filterName");
    const filterDept = document.getElementById("filterDept");
    const filterStatus = document.getElementById("filterStatus");
    const btnReset = document.getElementById("btnReset");

    const btnAdd = document.getElementById("btnAdd");
    const btnExport = document.getElementById("btnExport");

    const themeSelect = document.getElementById("themeSelect");
    const bodyEl = document.body;

    // عناصر لوحة التحكم
    const dashTotalEmployees = document.getElementById("dashTotalEmployees");
    const dashActiveEmployees = document.getElementById("dashActiveEmployees");
    const dashMaleEmployees = document.getElementById("dashMaleEmployees");
    const dashFemaleEmployees = document.getElementById("dashFemaleEmployees");
    const dashTotalLeaves = document.getElementById("dashTotalLeaves");
    const dashAcceptedLeaves = document.getElementById("dashAcceptedLeaves");
    const dashPendingLeaves = document.getElementById("dashPendingLeaves");

    // عناصر الإجازات
    const leavesTableBody = document.getElementById("leavesTableBody");
    const totalLeavesSpan = document.getElementById("totalLeaves");
    const pendingLeavesSpan = document.getElementById("pendingLeaves");
    const acceptedLeavesSpan = document.getElementById("acceptedLeaves");
    const rejectedLeavesSpan = document.getElementById("rejectedLeaves");
    const btnAddLeave = document.getElementById("btnAddLeave");
    const filterLeaveForm = document.getElementById("filterLeaveForm");
    const filterLeaveName = document.getElementById("filterLeaveName");
    const filterLeaveType = document.getElementById("filterLeaveType");
    const filterLeaveStatus = document.getElementById("filterLeaveStatus");
    const btnResetLeaves = document.getElementById("btnResetLeaves");

    // عناصر التقارير
    const deptReportBody = document.getElementById("deptReportBody");
    const statusReportBody = document.getElementById("statusReportBody");
    const genderMaleReport = document.getElementById("genderMaleReport");
    const genderFemaleReport = document.getElementById("genderFemaleReport");
    const genderOtherReport = document.getElementById("genderOtherReport");
    const reportTotalEmployees = document.getElementById("reportTotalEmployees");
    const reportActiveEmployees = document.getElementById("reportActiveEmployees");
    const reportTotalLeaves = document.getElementById("reportTotalLeaves");
    const reportAcceptedLeaves = document.getElementById("reportAcceptedLeaves");
    const reportPendingLeaves = document.getElementById("reportPendingLeaves");

    // ===========================
    // تنسيق التاريخ
    // ===========================
    function formatDate(dateStr) {
        if (!dateStr) return "";
        const d = new Date(dateStr);
        if (isNaN(d.getTime())) return dateStr;
        const day = d.getDate().toString().padStart(2, "0");
        const month = (d.getMonth() + 1).toString().padStart(2, "0");
        const year = d.getFullYear();
        return `${day}/${month}/${year}`;
    }

    // ===========================
    // إحصائيات الموظفين
    // ===========================
    function calculateEmployeeStats(list) {
        const stats = {
            total: list.length,
            active: 0,
            male: 0,
            female: 0,
            other: 0,
            byStatus: {},
            byDept: {}
        };

        list.forEach(emp => {
            if (emp.status === "مستمر بالخدمة") stats.active++;

            const st = emp.status || "غير محدد";
            stats.byStatus[st] = (stats.byStatus[st] || 0) + 1;

            const dept = emp.department || "غير محدد";
            stats.byDept[dept] = (stats.byDept[dept] || 0) + 1;

            if (!emp.gender) {
                stats.other++;
            } else if (emp.gender === "ذكر") {
                stats.male++;
            } else if (emp.gender === "أنثى") {
                stats.female++;
            } else {
                stats.other++;
            }
        });

        return stats;
    }

    function renderEmployeeStats(list) {
        const stats = calculateEmployeeStats(list);

        if (totalCountSpan) totalCountSpan.textContent = stats.total.toString();
        if (activeCountSpan) activeCountSpan.textContent = stats.active.toString();
        if (maleCountSpan) maleCountSpan.textContent = stats.male.toString();
        if (femaleCountSpan) femaleCountSpan.textContent = stats.female.toString();

        if (statusStatsSpan) {
            const parts = [];
            for (const [status, count] of Object.entries(stats.byStatus)) {
                parts.push(`${status}: ${count}`);
            }
            statusStatsSpan.textContent = parts.join(" | ");
        }

        if (deptStatsSpan) {
            const parts = [];
            for (const [dept, count] of Object.entries(stats.byDept)) {
                parts.push(`${dept}: ${count}`);
            }
            deptStatsSpan.textContent = parts.join(" | ");
        }

        // لوحة التحكم
        if (dashTotalEmployees) dashTotalEmployees.textContent = stats.total.toString();
        if (dashActiveEmployees) dashActiveEmployees.textContent = stats.active.toString();
        if (dashMaleEmployees) dashMaleEmployees.textContent = stats.male.toString();
        if (dashFemaleEmployees) dashFemaleEmployees.textContent = stats.female.toString();

        // التقارير
        if (reportTotalEmployees) reportTotalEmployees.textContent = stats.total.toString();
        if (reportActiveEmployees) reportActiveEmployees.textContent = stats.active.toString();

        if (deptReportBody) {
            deptReportBody.innerHTML = "";
            Object.entries(stats.byDept).forEach(([dept, count]) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${dept}</td><td>${count}</td>`;
                deptReportBody.appendChild(tr);
            });
        }

        if (statusReportBody) {
            statusReportBody.innerHTML = "";
            Object.entries(stats.byStatus).forEach(([st, count]) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${st}</td><td>${count}</td>`;
                statusReportBody.appendChild(tr);
            });
        }

        if (genderMaleReport) genderMaleReport.textContent = stats.male.toString();
        if (genderFemaleReport) genderFemaleReport.textContent = stats.female.toString();
        if (genderOtherReport) genderOtherReport.textContent = stats.other.toString();
    }

    // ===========================
    // تعبئة جدول الموظفين
    // ===========================
    function renderEmployees(list) {
        tableBody.innerHTML = "";

        list.forEach((emp, index) => {
            const tr = document.createElement("tr");

            const statusBadgeClass =
                emp.status === "مستمر بالخدمة" ? "bg-success" :
                emp.status === "إجازة" ? "bg-warning" :
                emp.status === "متقاعد" ? "bg-secondary" :
                "bg-info";

            tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${emp.fullName}</td>
                <td>${emp.jobNumber}</td>
                <td>${emp.jobTitle}</td>
                <td>${emp.department}</td>
                <td>${formatDate(emp.hireDate)}</td>
                <td><span class="badge ${statusBadgeClass} badge-status">${emp.status}</span></td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="viewEmployee(${emp.id})">عرض</button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="editEmployee(${emp.id})">تعديل</button>
                </td>
            `;
            tableBody.appendChild(tr);
        });

        renderEmployeeStats(list);
    }

    // ===========================
    // الثيمات
    // ===========================
    function applyTheme(themeClass) {
        bodyEl.classList.remove(
            "theme-light",
            "theme-dark",
            "theme-ocean",
            "theme-sepia",
            "theme-comfort"
        );
        bodyEl.classList.add(themeClass);
        localStorage.setItem("hr_theme", themeClass);
    }

    if (themeSelect) {
        themeSelect.addEventListener("change", (e) => {
            applyTheme(e.target.value);
        });
    }

    const savedTheme = localStorage.getItem("hr_theme");
    if (savedTheme) {
        applyTheme(savedTheme);
        if (themeSelect) themeSelect.value = savedTheme;
    } else {
        applyTheme("theme-comfort");
        if (themeSelect) themeSelect.value = "theme-comfort";
    }

    // ===========================
    // البحث والفلاتر للموظفين
    // ===========================
    function applyEmployeeFilters() {
        const nameValue = filterName ? filterName.value.trim() : "";
        const deptValue = filterDept ? filterDept.value : "";
        const statusValue = filterStatus ? filterStatus.value : "";

        currentView = employees.filter(emp => {
            const matchesName = !nameValue || emp.fullName.includes(nameValue);
            const matchesDept = !deptValue || emp.department === deptValue;
            const matchesStatus = !statusValue || emp.status === statusValue;
            return matchesName && matchesDept && matchesStatus;
        });

        renderEmployees(currentView);
    }

    if (filterForm) {
        filterForm.addEventListener("submit", (e) => {
            e.preventDefault();
            applyEmployeeFilters();
        });
    }

    if (btnReset) {
        btnReset.addEventListener("click", () => {
            if (filterName) filterName.value = "";
            if (filterDept) filterDept.value = "";
            if (filterStatus) filterStatus.value = "";
            currentView = [...employees];
            renderEmployees(currentView);
        });
    }

    // ===========================
    // إضافة / تصدير الموظفين
    // ===========================
    if (btnAdd) {
        btnAdd.addEventListener("click", () => {
            const fullName = prompt("أدخل الاسم الكامل للموظف:");
            if (!fullName) return;

            const jobNumber = prompt("أدخل الرقم الوظيفي:", Date.now().toString());
            const jobTitle = prompt("أدخل العنوان الوظيفي:", "موظف");
            const department = prompt("أدخل الدائرة:", "مكتب الوزير / الملاك");
            const hireDate = prompt("أدخل تاريخ التعيين بصيغة YYYY-MM-DD:", "2025-01-01");
            const status = prompt("أدخل الحالة الوظيفية (مستمر بالخدمة / إجازة / متقاعد / متدرب):", "مستمر بالخدمة");
            const gender = prompt("أدخل الجنس (ذكر / أنثى):", "ذكر");

            const newId = employees.length ? Math.max(...employees.map(e => e.id)) + 1 : 1;

            const newEmp = {
                id: newId,
                fullName,
                jobNumber: jobNumber || "",
                jobTitle: jobTitle || "",
                department: department || "",
                hireDate: hireDate || "",
                status: status || "مستمر بالخدمة",
                gender: gender || ""
            };

            employees.push(newEmp);
            currentView = [...employees];
            renderEmployees(currentView);
            alert("تمت إضافة الموظف بنجاح.");
        });
    }

    if (btnExport) {
        btnExport.addEventListener("click", () => {
            exportEmployeesToCSV(currentView);
        });
    }

    function exportEmployeesToCSV(list) {
        if (!list.length) {
            alert("لا توجد بيانات لتصديرها.");
            return;
        }

        const header = [
            "id",
            "fullName",
            "jobNumber",
            "jobTitle",
            "department",
            "hireDate",
            "status",
            "gender"
        ];

        const rows = list.map(emp => [
            emp.id,
            emp.fullName,
            emp.jobNumber,
            emp.jobTitle,
            emp.department,
            emp.hireDate,
            emp.status,
            emp.gender || ""
        ]);

        const csvContent = [header, ...rows]
            .map(r => r.map(field => `"${String(field).replace(/"/g, '""')}"`).join(","))
            .join("\n");

        const blob = new Blob([csvContent, ], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);

        const link = document.createElement("a");
        link.href = url;
        link.download = "employees.csv";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    // ===========================
    // عرض / تعديل موظف
    // ===========================
    window.viewEmployee = function (id) {
        const emp = employees.find(e => e.id === id);
        if (!emp) {
            alert("لم يتم العثور على الموظف.");
            return;
        }

        const info =
            "معلومات الموظف:\n\n" +
            `الاسم الكامل: ${emp.fullName}\n` +
            `الرقم الوظيفي: ${emp.jobNumber}\n` +
            `العنوان الوظيفي: ${emp.jobTitle}\n` +
            `الدائرة: ${emp.department}\n` +
            `تاريخ التعيين: ${formatDate(emp.hireDate)}\n` +
            `الحالة الوظيفية: ${emp.status}\n` +
            `الجنس: ${emp.gender || "غير محدد"}`;

        alert(info);
    };

    window.editEmployee = function (id) {
        const emp = employees.find(e => e.id === id);
        if (!emp) {
            alert("لم يتم العثور على الموظف.");
            return;
        }

        const fullName = prompt("تعديل الاسم الكامل:", emp.fullName);
        if (!fullName) return;

        const jobNumber = prompt("تعديل الرقم الوظيفي:", emp.jobNumber);
        const jobTitle = prompt("تعديل العنوان الوظيفي:", emp.jobTitle);
        const department = prompt("تعديل الدائرة:", emp.department);
        const hireDate = prompt("تعديل تاريخ التعيين (YYYY-MM-DD):", emp.hireDate);
        const status = prompt("تعديل الحالة الوظيفية:", emp.status);
        const gender = prompt("تعديل الجنس (ذكر / أنثى):", emp.gender || "");

        emp.fullName = fullName;
        emp.jobNumber = jobNumber || "";
        emp.jobTitle = jobTitle || "";
        emp.department = department || "";
        emp.hireDate = hireDate || "";
        emp.status = status || emp.status;
        emp.gender = gender || emp.gender;

        renderEmployees(currentView);
        alert("تم تحديث بيانات الموظف.");
    };

    // ===========================
    // الإجازات: إحصائيات + عرض
    // ===========================
    function calculateLeaveStats(list) {
        const stats = {
            total: list.length,
            pending: 0,
            accepted: 0,
            rejected: 0
        };

        list.forEach(l => {
            if (l.status === "مقدمة") stats.pending++;
            else if (l.status === "مقبولة") stats.accepted++;
            else if (l.status === "مرفوضة") stats.rejected++;
        });

        return stats;
    }

    function renderLeaveStats(list) {
        const stats = calculateLeaveStats(list);

        if (totalLeavesSpan) totalLeavesSpan.textContent = stats.total.toString();
        if (pendingLeavesSpan) pendingLeavesSpan.textContent = stats.pending.toString();
        if (acceptedLeavesSpan) acceptedLeavesSpan.textContent = stats.accepted.toString();
        if (rejectedLeavesSpan) rejectedLeavesSpan.textContent = stats.rejected.toString();

        // لوحة التحكم
        if (dashTotalLeaves) dashTotalLeaves.textContent = stats.total.toString();
        if (dashAcceptedLeaves) dashAcceptedLeaves.textContent = stats.accepted.toString();
        if (dashPendingLeaves) dashPendingLeaves.textContent = stats.pending.toString();

        // التقارير
        if (reportTotalLeaves) reportTotalLeaves.textContent = stats.total.toString();
        if (reportAcceptedLeaves) reportAcceptedLeaves.textContent = stats.accepted.toString();
        if (reportPendingLeaves) reportPendingLeaves.textContent = stats.pending.toString();
    }

    function renderLeaves(list) {
        leavesTableBody.innerHTML = "";

        list.forEach((lv, index) => {
            const tr = document.createElement("tr");

            const statusBadgeClass =
                lv.status === "مقبولة" ? "bg-success" :
                lv.status === "مقدمة" ? "bg-warning" :
                lv.status === "مرفوضة" ? "bg-danger" :
                "bg-secondary";

            tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${lv.employeeName}</td>
                <td>${lv.type}</td>
                <td>${formatDate(lv.startDate)}</td>
                <td>${formatDate(lv.endDate)}</td>
                <td><span class="badge ${statusBadgeClass} badge-status">${lv.status}</span></td>
                <td>${lv.approvedBy || "-"}</td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="viewLeave(${lv.id})">عرض</button>
                    <button class="btn btn-sm btn-outline-secondary me-1" onclick="editLeaveStatus(${lv.id})">تحديث الحالة</button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteLeave(${lv.id})">حذف</button>
                </td>
            `;
            leavesTableBody.appendChild(tr);
        });

        renderLeaveStats(list);
    }

    // فلترة الإجازات
    function applyLeaveFilters() {
        const nameValue = filterLeaveName ? filterLeaveName.value.trim() : "";
        const typeValue = filterLeaveType ? filterLeaveType.value : "";
        const statusValue = filterLeaveStatus ? filterLeaveStatus.value : "";

        currentLeavesView = leaves.filter(lv => {
            const matchesName = !nameValue || lv.employeeName.includes(nameValue);
            const matchesType = !typeValue || lv.type === typeValue;
            const matchesStatus = !statusValue || lv.status === statusValue;
            return matchesName && matchesType && matchesStatus;
        });

        renderLeaves(currentLeavesView);
    }

    if (filterLeaveForm) {
        filterLeaveForm.addEventListener("submit", (e) => {
            e.preventDefault();
            applyLeaveFilters();
        });
    }

    if (btnResetLeaves) {
        btnResetLeaves.addEventListener("click", () => {
            if (filterLeaveName) filterLeaveName.value = "";
            if (filterLeaveType) filterLeaveType.value = "";
            if (filterLeaveStatus) filterLeaveStatus.value = "";
            currentLeavesView = [...leaves];
            renderLeaves(currentLeavesView);
        });
    }

    // إضافة إجازة جديدة
    if (btnAddLeave) {
        btnAddLeave.addEventListener("click", () => {
            const employeeName = prompt("أدخل اسم الموظف:");
            if (!employeeName) return;

            const type = prompt("أدخل نوع الإجازة (اعتيادية / مرضية / طارئة / دراسية):", "اعتيادية");
            const startDate = prompt("أدخل تاريخ بدء الإجازة (YYYY-MM-DD):", "2025-01-01");
            const endDate = prompt("أدخل تاريخ نهاية الإجازة (YYYY-MM-DD):", "2025-01-07");
            const status = prompt("أدخل حالة الطلب (مقدمة / مقبولة / مرفوضة / منتهية):", "مقدمة");
            const approvedBy = prompt("اسم المعتمد (يمكن تركه فارغاً):", "");

            const newId = leaves.length ? Math.max(...leaves.map(l => l.id)) + 1 : 1;

            const newLeave = {
                id: newId,
                employeeId: null,
                employeeName,
                type: type || "اعتيادية",
                startDate: startDate || "",
                endDate: endDate || "",
                status: status || "مقدمة",
                approvedBy: approvedBy || ""
            };

            leaves.push(newLeave);
            currentLeavesView = [...leaves];
            renderLeaves(currentLeavesView);
            alert("تمت إضافة طلب الإجازة.");
        });
    }

    // عرض / تعديل / حذف إجازة
    window.viewLeave = function (id) {
        const lv = leaves.find(l => l.id === id);
        if (!lv) {
            alert("لم يتم العثور على الإجازة.");
            return;
        }

        const info =
            "معلومات الإجازة:\n\n" +
            `الموظف: ${lv.employeeName}\n` +
            `نوع الإجازة: ${lv.type}\n` +
            `من: ${formatDate(lv.startDate)}\n` +
            `إلى: ${formatDate(lv.endDate)}\n` +
            `الحالة: ${lv.status}\n` +
            `المعتمد: ${lv.approvedBy || "-"}`;

        alert(info);
    };

    window.editLeaveStatus = function (id) {
        const lv = leaves.find(l => l.id === id);
        if (!lv) {
            alert("لم يتم العثور على الإجازة.");
            return;
        }

        const status = prompt(
            "تحديث حالة الإجازة (مقدمة / مقبولة / مرفوضة / منتهية):",
            lv.status
        );
        if (!status) return;

        const approvedBy = prompt("اسم المعتمد (يمكن تركه فارغاً):", lv.approvedBy || "");

        lv.status = status;
        lv.approvedBy = approvedBy || lv.approvedBy;

        renderLeaves(currentLeavesView);
        alert("تم تحديث حالة الإجازة.");
    };

    window.deleteLeave = function (id) {
        if (!confirm("هل أنت متأكد من حذف هذه الإجازة؟")) return;
        const index = leaves.findIndex(l => l.id === id);
        if (index === -1) {
            alert("لم يتم العثور على الإجازة.");
            return;
        }
        leaves.splice(index, 1);
        currentLeavesView = [...leaves];
        renderLeaves(currentLeavesView);
        alert("تم حذف الإجازة.");
    };

    // ===========================
    // التنقل بين الأقسام (لوحة التحكم / الموظفون / الإجازات / التقارير)
    // ===========================
    const navLinks = document.querySelectorAll('.sidebar .nav-link');

    function showSection(sectionId) {
        const sectionIds = ['dashboard', 'employees', 'leaves', 'reports'];

        sectionIds.forEach(id => {
            const sec = document.getElementById(id);
            if (!sec) return;

            if (id === sectionId) {
                sec.classList.remove('d-none');
            } else {
                sec.classList.add('d-none');
            }
        });

        navLinks.forEach(link => {
            const href = link.getAttribute('href') || '';
            if (!href.startsWith('#')) return;
            const targetId = href.substring(1);
            link.classList.toggle('active', targetId === sectionId);
        });

        window.scrollTo({ top: 0, behavior: 'auto' });
    }

    navLinks.forEach(link => {
        const href = link.getAttribute('href') || '';
        if (!href.startsWith('#')) return;
        const targetId = href.substring(1);

        if (['dashboard', 'employees', 'leaves', 'reports'].includes(targetId)) {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showSection(targetId);
            });
        }
    });

    // تفعيل قسم افتراضي عند التحميل (لوحة التحكم)
    showSection('dashboard');

    // تسجيل الخروج (مؤقت)
    const logoutLink = Array.from(navLinks).find(l =>
        (l.textContent || '').trim() === 'تسجيل الخروج'
    );
    if (logoutLink) {
        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            alert('تم تسجيل الخروج (تجريبيًا). يمكن ربطه لاحقاً بصفحة تسجيل الدخول.');
        });
    }

    // ===========================
    // أول تحميل للبيانات
    // ===========================
    currentView = [...employees];
    currentLeavesView = [...leaves];
    renderEmployees(currentView);
    renderLeaves(currentLeavesView);
</script>
